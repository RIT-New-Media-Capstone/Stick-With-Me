<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stick With Me - Streamer View</title>
    <style>
        #canvas {
            border: 1px solid black;
            position: relative;
        }
        .sticker {
            width: 100px;
            height: 100px;
            position: absolute;
            cursor: move;
        }
        #sticker1 {
            top: 600px;
            left: 10px;
        }
        #sticker2 {
            top: 600px;
            left: 120px;
        }
        #sticker3 {
            top: 600px;
            left: 230px;
        }
    </style>
</head>
<body>
    <h1>Streamer View</h1>
    <div>
    <canvas id="canvas" width="640" height="480"></canvas>
    <img src="/assets/Heart_Sticker.gif" class="sticker" id="sticker1" draggable="true">
    <img src="/assets/Sad_Cloud_Sticker.gif" class="sticker" id="sticker2" draggable="true">
    <img src="/assets/Star_Sticker.gif" class="sticker" id="sticker3" draggable="true">
    
    <script>
        const canvas = document.getElementById('canvas');
        const context = canvas.getContext('2d');

        // Create a video element to capture the webcam stream
        const video = document.createElement('video');
        video.width = 640;
        video.height = 480;
        video.autoplay = true;

        // Request access to the webcam
        navigator.mediaDevices.getUserMedia({ video: true })
            .then((stream) => {
                // Set the video source to the webcam stream
                video.srcObject = stream;

                // Draw the video frame to the canvas at regular intervals
                video.addEventListener('play', () => {
                    const drawFrame = () => {
                        if (!video.paused && !video.ended) {
                            context.drawImage(video, 0, 0, canvas.width, canvas.height);
                            requestAnimationFrame(drawFrame);
                        }
                    };
                    drawFrame();
                });
            })
            .catch((err) => {
                console.error('Error accessing webcam: ', err);
            });

        // Make stickers draggable
        const stickers = document.querySelectorAll('.sticker');
        stickers.forEach(sticker => {
            sticker.addEventListener('dragstart', dragStart);
            sticker.addEventListener('dragend', dragEnd);
        });

        function dragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.id);
            setTimeout(() => {
                e.target.style.display = 'none';
            }, 0);
        }

        function dragEnd(e) {
            e.target.style.display = 'block';
            e.target.style.left = `${e.pageX - canvas.offsetLeft - e.target.width / 2}px`;
            e.target.style.top = `${e.pageY - canvas.offsetTop - e.target.height / 2}px`;
        }

        // Allow dropping on the canvas
        canvas.addEventListener('dragover', dragOver);
        canvas.addEventListener('drop', drop);

        function dragOver(e) {
            e.preventDefault();
        }

        function drop(e) {
            e.preventDefault();
            const id = e.dataTransfer.getData('text/plain');
            const sticker = document.getElementById(id);
            sticker.style.left = `${e.pageX - canvas.offsetLeft - sticker.width / 2}px`;
            sticker.style.top = `${e.pageY - canvas.offsetTop - sticker.height / 2}px`;
        }
    </script>
</body>
</html>